#!/usr/bin/perl -w

use strict;
use File::stat;


my %suite = ( bh => 'olden',
	      bisort => 'olden',
	      em3d => 'olden',
	      health => 'olden',
	      mst => 'olden',
	      perimeter => 'olden',
	      power => 'olden',
	      treeadd => 'olden',
	      tsp => 'olden',
	      compress => 'spec95',
	      go => 'spec95',
	      ijpeg => 'spec95',
	      li => 'spec95' );	      


my %size;

foreach my $exe (glob("*/sample-*.exe"), glob("*/always-none.exe")) {
    $exe =~ /^(.+)\/(.+)\.exe$/;
    $size{$1}{$2} = stat($exe)->size;
}


local ($,, $\) = ("\t", "\n");
my %total;
my %count;

while (my ($benchmark, $size) = each %size) {
    while (my $where = each %{$size}) {
	next if $where eq 'always-none';
	next if $where eq 'sample-all';
	my $always = $size->{'always-none'} or die;
	my $sample = $size->{$where} or die;
	my $growth = $sample / $always;
	my $suite = $suite{$benchmark};
	# print $suite, $benchmark, $where, $growth;
	$total{$suite} += $growth;
	++$count{$suite};
    }
}


while (my $suite = each %total) {
    print $suite, $total{$suite} / $count{$suite};
}
