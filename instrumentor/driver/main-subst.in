#!/usr/bin/perl -w

use strict;
use FindBin;
use lib "$FindBin::Bin/@srcdir@";
use lib '@CIL_HOME@/bin';
use lib '@CIL_HOME@/lib';

my $scheme = shift or die "Usage: $0 <scheme> [<compiler arguments> ...]\n";

our $libm = '@LIBM@';
our $root = "$FindBin::Bin/@top_srcdir@";
our $home = "$root/instrumentor/$scheme";

die unless -d $root;
die unless -d $home;

my $module = "$home/Driver.pm";
unless (my $return = do $module) {
    warn "cannot parse instrumentation module $module: $!\n" if $@;
    warn "cannot read instrumentation module $module: $!\n" unless defined $return;
    warn "cannot run instrumentation module $module\n" unless $return;
    die;
}

Driver->new(@ARGV)->doit();
