AT_INIT(nothing)

AT_SETUP(sharing)
AT_CHECK([
set -e
cc="$abs_top_builddir/instrumentor/driver/sampler-cc-here nothing"
$cc -shared -o plugin.so $abs_srcdir/plugin.c
$cc -shared -o library.so $abs_srcdir/library.c
$cc -c $abs_srcdir/main.c
$cc -Wl,-rpath,. -o main main.o library.so -ldl
SAMPLER_SPARSITY=1 ./main
], 0)
AT_CLEANUP

AT_SETUP(cfg)
AT_CHECK([
set -e
cp $abs_srcdir/cfg.expected expout
cp $abs_srcdir/cfg.c .
cc="$abs_top_builddir/instrumentor/driver/sampler-cc-here nothing"
$cc -c cfg.c
$abs_top_srcdir/tools/resolve-cfg cfg.o
], 0, expout)
AT_CLEANUP
