*embedding:
-fsave-cfg %g.cfg \
-fsave-site-info %g.sites

*cpp_threads:
%{fthreads:-D SAMPLER_THREADS} \
%{!fthreads:%{!fno-threads:%{pthread:-D SAMPLER_THREADS}}}

*cpp_cyclic:
%{!fcyclic:-include sampler/acyclic.h} \
%{fcyclic:-include sampler/cyclic.h}

*cpp_timestamps:
%{ftimestamps:-D SAMPLER_TIMESTAMPS}

*cpp:
+ -DCIL \
%(cpp_threads) \
%(cpp_timestamps) \
-include sampler/countdown.h \
%(cpp_cyclic) \
%{fsampler-scheme=bounds:-include sampler/bounds-unit.h} \
%{fsampler-scheme=branches:-include sampler/branches-unit.h} \
%{fsampler-scheme=function-entries:-include sampler/function-entries-unit.h} \
%{fsampler-scheme=g-object-unref:-include sampler/g-object-unref-unit.h} \
%{fsampler-scheme=returns:-include sampler/returns-unit.h} \
%{fsampler-scheme=scalar-pairs:-include sampler/scalar-pairs-unit.h} \
%{fsampler-scheme=*:-include sampler/unit.h}

*cc1:
+ %{v} \
%{!fno-threads:%{!fthreads:%{pthread:-fthreads}}} \
-finstrumentor-input %u.i \
-finstrumentor-output %u.inst.i \
%(embedding)

*asm_final:
+ %{v:--verbose} \
%(embedding)

%rename lib old_lib

*wrap:
--wrap pthread_create

*lib_threads:
%{fthreads:%(wrap)}%{!fthreads:%{!fno-threads:%{pthread:%(wrap)}}} -lsampler%{fthreads:_r -lpthread}%{!fthreads:%{!fno-threads:%{pthread:_r}}}

*lib:
%{fsampler-scheme=*:-lschemes} \
%(lib_threads) \
%{fsampler-scheme=*:-ldump%{ftimestamps:-timestamps}} \
%(old_lib)
