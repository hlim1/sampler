#!/usr/bin/perl -w

use strict;
use FileHandle;


local $, = "\t";
local $\ = "\n";
print('benchmark', 'form', 'seed',
      'user', 'system', 'elapsed', 'cpu', 'text', 'data', 'max',
      'inputs', 'outputs', 'major', 'minor', 'swaps');


my @logs = glob '*/*.*.time';

foreach my $log (@logs) {
    $log =~ /^(.+)\/(.+)\.times$/ or die;
    my ($benchmark, $form) = ($1, $2);

    my $file = new FileHandle($log, 'r') or die;
    my $seed;
    my ($user, $system, $elapsedMin, $elapsedSec, $cpu, $text, $data, $max);
    my ($inputs, $outputs, $major, $minor, $swaps);

    while (<$file>) {
	$seed = $1
	    if /GSL_RNG_SEED=(\d+)/;
	($user, $system, $elapsedMin, $elapsedSec, $cpu, $text, $data, $max) = ($1, $2, $3, $4, $5, $6, $7, $8)
	    if /(\d+\.\d+)user (\d+\.\d+)system (\d+):(\d+\.\d+)elapsed (\d+)%CPU \((\d+)avgtext\+(\d+)avgdata (\d+)maxresident\)k/;
	($inputs, $outputs, $major, $minor, $swaps) = ($1, $2, $3, $4, $5)
	    if /(\d+)inputs\+(\d+)outputs \((\d+)major\+(\d+)minor\)pagefaults (\d+)swaps/;
    }

    die unless defined $seed;
    die unless defined $user;
    die unless defined $inputs;
	    
    my $elapsed = 60 * $elapsedMin + $elapsedSec;
    print($benchmark, $form, $seed,
	  $user, $system, $elapsed, $cpu, $text, $data, $max,
	  $inputs, $outputs, $major, $minor, $swaps);
}
